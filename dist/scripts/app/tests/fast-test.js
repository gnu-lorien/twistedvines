define(["underscore","jquery","parse","../models/Vampire","backbone","marionette","../models/Troupe","../models/SimpleTrait","../testsiteconfig","../models/Werewolf"],function(e,t,n,i,o,c,r,a,g,s){jasmine.DEFAULT_TIMEOUT_INTERVAL=6e4;var _=function(){n.$=t,n.initialize("APPLICATION_ID","yymp8UWnJ7Va32Y2Q4uzvWxfPTYuDvZSA8kdhmdR"),n.serverURL=g.serverURL};describe("A suite",function(){it("contains spec with an expectation",function(){expect(!0).toBe(!0)})});var u=function(){return _(),e.eq(n.User.current().get("username"),"devuser")?n.Promise.as(n.User.current()):n.User.logIn("devuser","thedumbness")};describe("Parse",function(){beforeAll(function(){_(),n.User.current()&&n.User.logOut()}),it("isn't logged in",function(){expect(n.User.current()).toBe(null)}),it("can fail to log in",function(e){n.User.logIn("devuser","thewrongness").then(function(t){e.fail("Logged in with bad password")},function(t,n){e(n)})}),it("can log in",function(e){n.User.logIn("devuser","thedumbness").then(function(t){e()},function(t,n){e.fail(n)})})}),describe("A Vampire's creation",function(){var t;beforeAll(function(e){u().then(function(){return i.create_test_character("vampirecreation")}).then(function(e){return i.get_character(e.id)}).then(function(n){t=n,e()},function(t){e.fail(t)})}),it("can pick a merit",function(e){var n=t.get("creation");expect(n.get("merits_0_remaining")).toBe(7),expect(n.get("merits_0_picks")).toBe(void 0),t.update_trait("Bloodline: Coyote",2,"merits",0,!0).then(function(e){return expect(t.get("creation").get("merits_0_remaining")).toBe(5),expect(t.get("creation").get("merits_0_picks").length).toBe(1),expect(t.get("creation").get("merits_0_picks")[0].get("name")).toBe("Bloodline: Coyote"),expect(t.get("creation").get("merits_0_picks")[0].get("value")).toBe(2),t.get_trait("merits",e)}).then(function(t){expect(t).not.toBe(void 0),expect(t.get("name")).toBe("Bloodline: Coyote"),expect(t.get("value")).toBe(2),e()},function(t){e.fail(t)})}),it("can change the value of a picked merit",function(e){var n=t.get("creation");expect(n.get("merits_0_remaining")).toBe(5),expect(n.get("merits_0_picks").length).toBe(1),t.update_trait("Bloodline: Coyote",3,"merits",0,!0).then(function(e){return expect(t.get("creation").get("merits_0_remaining")).toBe(4),expect(t.get("creation").get("merits_0_picks").length).toBe(1),expect(t.get("creation").get("merits_0_picks")[0].get("name")).toBe("Bloodline: Coyote"),expect(t.get("creation").get("merits_0_picks")[0].get("value")).toBe(3),t.get_trait("merits",e)}).then(function(t){expect(t).not.toBe(void 0),expect(t.get("name")).toBe("Bloodline: Coyote"),expect(t.get("value")).toBe(3),e()},function(t){e.fail(t)})}),it("can unpick a merit with a changed value",function(n){expect(t.get("creation").get("merits_0_remaining")).toBe(4),expect(t.get("creation").get("merits_0_picks").length).toBe(1);var i=e.first(t.get("creation").get("merits_0_picks"));t.get_trait("merits",i).then(function(e){return expect(e.get("name")).toBe("Bloodline: Coyote"),expect(e.get("value")).toBe(3),t.unpick_from_creation("merits",e,0,!0)}).then(function(){expect(t.get("creation").get("merits_0_remaining")).toBe(7),expect(t.get("creation").get("merits_0_picks").length).toBe(0),expect(t.get("merits").length).toBe(0),n()},function(e){n.fail(e)})})}),describe("A Werewolf's creation",function(){var t;beforeAll(function(e){u().then(function(){return s.create_test_character("vampirecreation")}).then(function(e){return s.get_character(e.id)}).then(function(n){t=n,e()},function(t){e.fail(t)})}),it("can pick a clan",function(e){t.update_text("clan","TestClan").then(function(){expect(t.get("clan")).toBe("TestClan"),e()},function(t){e.fail(t)})}),it("can pick a merit",function(e){var n=t.get("creation");expect(n.get("wta_merits_0_remaining")).toBe(7),expect(n.get("wta_merits_0_picks")).toBe(void 0),t.update_trait("Bloodline: Coyote",2,"wta_merits",0,!0).then(function(e){return expect(t.get("creation").get("wta_merits_0_remaining")).toBe(5),expect(t.get("creation").get("wta_merits_0_picks").length).toBe(1),expect(t.get("creation").get("wta_merits_0_picks")[0].get("name")).toBe("Bloodline: Coyote"),expect(t.get("creation").get("wta_merits_0_picks")[0].get("value")).toBe(2),t.get_trait("wta_merits",e)}).then(function(t){expect(t).not.toBe(void 0),expect(t.get("name")).toBe("Bloodline: Coyote"),expect(t.get("value")).toBe(2),e()},function(t){e.fail(t)})}),it("can change the value of a picked merit",function(e){var n=t.get("creation");expect(n.get("wta_merits_0_remaining")).toBe(5),expect(n.get("wta_merits_0_picks").length).toBe(1),t.update_trait("Bloodline: Coyote",3,"wta_merits",0,!0).then(function(e){return expect(t.get("creation").get("wta_merits_0_remaining")).toBe(4),expect(t.get("creation").get("wta_merits_0_picks").length).toBe(1),expect(t.get("creation").get("wta_merits_0_picks")[0].get("name")).toBe("Bloodline: Coyote"),expect(t.get("creation").get("wta_merits_0_picks")[0].get("value")).toBe(3),t.get_trait("wta_merits",e)}).then(function(t){expect(t).not.toBe(void 0),expect(t.get("name")).toBe("Bloodline: Coyote"),expect(t.get("value")).toBe(3),e()},function(t){e.fail(t)})}),it("can unpick a merit with a changed value",function(n){expect(t.get("creation").get("wta_merits_0_remaining")).toBe(4),expect(t.get("creation").get("wta_merits_0_picks").length).toBe(1);var i=e.first(t.get("creation").get("wta_merits_0_picks"));t.get_trait("wta_merits",i).then(function(e){return expect(e.get("name")).toBe("Bloodline: Coyote"),expect(e.get("value")).toBe(3),t.unpick_from_creation("wta_merits",e,0,!0)}).then(function(){expect(t.get("creation").get("wta_merits_0_remaining")).toBe(7),expect(t.get("creation").get("wta_merits_0_picks").length).toBe(0),expect(t.get("wta_merits").length).toBe(0),n()},function(e){n.fail(e)})})})});