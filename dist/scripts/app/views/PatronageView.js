define(["jquery","backbone","marionette","text!../templates/patronage-list-item.html","backform","bootstrap-datepicker","moment","../helpers/UserWreqr"],function(e,t,n,a,s,r,o,i){var l=t.View.extend({initialize:function(t){var n=this;n.options=t;var a="MM/DD/YYYY",r="mm/dd/yyyy",l=n.model.clone();l.has("owner")?l.set("owner",l.get("owner").id):n.isNew=!0,l.has("paidOn")&&l.set("paidOn",o(l.get("paidOn")).format(a)),l.has("expiresOn")&&l.set("expiresOn",o(l.get("expiresOn")).format(a));var m=i.channel.reqres.request("all").map(function(e){return{label:""+e.get("username")+" "+e.get("realname")+" "+e.get("email"),value:e.id}});m.unshift({label:"Invalid",value:""}),n.form=new s.Form({el:n.$el,model:l,fields:[{name:"owner",label:"Owner",control:"select",options:m},{name:"paidOn",label:"Paid on",control:"datepicker",type:"text",options:{autoclose:!0,format:r}},{name:"expiresOn",label:"Expires on",control:"datepicker",type:"text",options:{autoclose:!0,format:r}},{name:"submit",control:"button",label:"Save Changes"}],events:{submit:function(t){var s=this;t.preventDefault(),s.fields.at(3).set({status:"",message:""}),s.model.errorModel.clear(),n.model.set({paidOn:o(s.model.get("paidOn"),a).toDate(),expiresOn:o(s.model.get("expiresOn"),a).toDate(),owner:new Parse.User({id:s.model.get("owner")})});var r=new Parse.ACL;r.setPublicReadAccess(!0),r.setPublicWriteAccess(!1),r.setRoleReadAccess("Administrator",!0),r.setRoleWriteAccess("Administrator",!0),n.model.setACL(r),n.model.save().then(function(){s.fields.at(3).set({status:"success",message:"Save completed"}),_.defer(function(){e("body").enhanceWithin()})}).fail(function(e){s.model.errorModel.set("owner",_.escape(e.message))})}}})},tagName:"form",render:function(){return this.form.render(),this.$el.enhanceWithin(),this}});return l});