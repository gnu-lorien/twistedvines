define(["jquery","backbone","../models/SimpleTrait","../helpers/PromiseFailReport"],function(e,t,a,i){var r=t.View.extend({initialize:function(){_.bindAll(this,"remove","update_value","update_free_value","update_specialty_name","save_clicked","render_view")},register:function(e,t,a){var i=this,r=!1;return e!==i.character&&(i.character&&i.stopListening(i.character),i.character=e,i.listenTo(i.character,"change",i.render_view),r=!0),t!==i.simpletrait&&(i.simpletrait=t,r=!0),_.isEqual(a,i.category)||(i.category=a,r=!0),r?i.render():i},events:{"click .remove":"remove","change .value-slider":"update_value","change .free-slider":"update_free_value","change #specialize-name":"update_specialty_name","click .save":"save_clicked"},remove:function(t){var a=this;return t.preventDefault(),a.undelegateEvents(),e.mobile.loading("show"),console.log("remove value",a.category,a.simpletrait),a.character.remove_trait(a.simpletrait).fail(i).always(function(){window.location.hash="#simpletraits/"+a.category+"/"+a.character.id+"/all",a.delegateEvents()}),!1},update_value:function(e,t,a){var i=this;this.$(e.target).val();console.log("update value",i.category,i.simpletrait,this.$(e.target).val()),this.simpletrait.set("value",_.parseInt(this.$(e.target).val())),i.render_view()},update_free_value:function(e,t,a){var i=this;this.$(e.target).val();this.simpletrait.set("free_value",_.parseInt(this.$(e.target).val())),i.render_view()},update_specialty_name:function(e){var t=this;this.$(e.target).val();t.simpletrait.set_specialization(this.$(e.target).val()),t.render_view()},save_clicked:function(t){var a=this;return t.preventDefault(),e.mobile.loading("show"),_.defer(function(){console.log("save clicked",a.category,a.simpletrait),a.character.update_trait(a.simpletrait).then(function(e,t,i){console.log("asaved",a.category,a.simpletrait),window.location.hash="#simpletraits/"+a.category+"/"+a.character.id+"/all"},i)}),!1},render_view:function(){this.view_template=_.template(e("script#simpleTraitChangeView").html())({c:this.character,character:this.character,b:this.simpletrait,trait:this.simpletrait}),this.$el.find("#simpletrait-viewing").html(this.view_template)},render:function(){return this.template=_.template(e("script#simpleTraitChangeChange").html())({c:this.character,b:this.simpletrait,category:this.category,traitmax:this.character.max_trait_value(this.simpletrait)}),this.render_view(),this.$el.find("#simpletrait-changing").html(this.template),this.$el.find("#simpletrait-changing").enhanceWithin(),this}});return r});