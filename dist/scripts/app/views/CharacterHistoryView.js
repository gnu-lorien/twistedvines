define(["underscore","jquery","backbone","marionette","parse","moment","text!../templates/character-print-view.html","text!../templates/character-history-selected-view.html","text!../templates/character-history-view.html","../helpers/VampirePrintHelper","../views/CharacterPrintView"],function(e,t,i,n,r,d,o,a,s,l,h){var c=n.ItemView.extend({template:e.template(s),templateHelpers:function(){var e=this;return{character:this.model,logs:this.model.recorded_changes.models,idForPickedIndex:e.picked.get("value")}},modelEvents:{saved:"update_then_render"},events:{change:"update_picked"},initialize:function(t){this.picked=t.picked,this.override=t.override,e.bindAll(this,"templateHelpers")},update_picked:function(t){var i=this,n=e.parseInt(this.$(t.target).val());i.picked.set("value",n);var r=this.$("#history-changes-"+n).val(),d=e.chain(i.model.recorded_changes.models).takeRightWhile(function(e){return e.id!=r}).reverse().value(),o=i.model.get_transformed(d);i.override.set("character",o)},update_then_render:function(){var e=this;e.model.update_recorded_changes().then(function(){e.render()})},onRender:function(){this.$el.enhanceWithin()}}),m=n.ItemView.extend({template:e.template(a),templateHelpers:function(){var e=this;return{character:this.model,logs:this.model.recorded_changes.models,format_entry:this.format_entry,idForPickedIndex:e.picked.get("value")}},modelEvents:{add:"render",reset:"render"},initialize:function(t){this.picked=t.picked,this.listenTo(this.picked,"change",e.debounce(this.render,100,{trailing:!0})),e.bindAll(this,"templateHelpers")},format_entry:function(t,i){if(e.isUndefined(t))return console.log("Undefined log"),"Undefined log";if(t.get(i))return t.get(i);var n=t[i];return e.isDate(n)?d(n).format("lll"):n},onRender:function(){this.$el.enhanceWithin()}}),p=n.LayoutView.extend({tagName:"div",regions:{main:"#history-main",viewing:"#history-viewing",sheet:"#history-sheet"},register:function(e){var t=this,n=r.Promise.as([]);return e!=t.model&&(t.model=e,t.picked=new i.Model({value:0}),t.override=new i.Model({character:null}),n=t.model.get_recorded_changes().then(function(){t.picked.set("value",t.model.recorded_changes.models.length-1),t.showChildView("main",new c({model:t.model,picked:t.picked,override:t.override})),t.showChildView("viewing",new m({model:t.model,picked:t.picked}));var e=new h;e=e.setup(t.model,t.override),t.showChildView("sheet",e)})),n.then(function(){r.Promise.as(t)})},onRender:function(){this.$el.enhanceWithin()}});return p});